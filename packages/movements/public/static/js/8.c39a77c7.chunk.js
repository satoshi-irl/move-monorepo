(this["webpackJsonp@ted-monorepo/ui"]=this["webpackJsonp@ted-monorepo/ui"]||[]).push([[8],{1117:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return T}));var r=n(9),o=n(4),s=n(1),a=n(156),c=n(46),i=n(43),d=n(10),u=n(6),l=n(65),b=n(42),j=n(18),p=n(38),f=n(2),O=n.n(f),h=n(3),x=n(5),g=n(16),m=n(22),w=n(40),v=n(64),N=n(15),P=n(78),I=n(56),S=n(25),E=n(48),F=n(0),V={skipIsActiveMemberCheck:!0};function k(e){var t=e.disabled,n=e.proposal.snapshotProposal,r=Object(s.useState)(),a=Object(o.a)(r,2),c=a[0],i=a[1],d=Object(g.c)((function(e){return e.contracts})),j=Object(g.c)((function(e){return e.contracts.DaoRegistryContract})),f=Object(N.f)(),k=f.account,M=f.web3Instance,A=Object(N.a)(),D=A.txEtherscanURL,R=A.txIsPromptOpen,y=A.txSend,C=A.txStatus,G=Object(N.b)().average,L=Object(b.g)(V),_=L.isDisabled,T=L.openWhyDisabledModal,W=L.WhyDisabledModal,U=Object(g.b)(),J=C===u.f.AWAITING_CONFIRM||C===u.f.PENDING,Y=C===u.f.FULFILLED,q=J||Y||R,z=_||q||t;function B(){return(B=Object(x.a)(O.a.mark((function e(){var t,r,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,j){e.next=3;break}throw new Error("No DAO Registry contract was found.");case 3:if(n){e.next=5;break}throw new Error("No Snapshot proposal was found.");case 5:if(k){e.next=7;break}throw new Error("No account found.");case 7:if(M){e.next=9;break}throw new Error("No Web3 instance was found.");case 9:return t=Object(w.e)(n.actionId,d),r=[j.contractAddress,n.idInDAO],o=Object(h.a)({from:k||""},G?{gasPrice:G}:null),e.next=14,y("processProposal",t.instance.methods,r,o);case 14:if(!e.sent){e.next=18;break}return e.next=18,U(Object(m.A)({account:k,daoRegistryContract:j,web3Instance:M}));case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),i(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsxs)("div",{children:[Object(F.jsx)("button",{className:"proposaldetails__button",disabled:z,onClick:z?function(){}:function(){return B.apply(this,arguments)},children:J?Object(F.jsx)(E.a,{}):Y?"Done":"Process"}),Object(F.jsx)(p.a,{error:c,renderText:"Something went wrong"}),q&&Object(F.jsx)("div",{className:"form__submit-status-container",children:function(){switch(C){case u.f.AWAITING_CONFIRM:return Object(F.jsxs)(F.Fragment,{children:["Awaiting your confirmation",Object(F.jsx)(l.a,{})]});case u.f.PENDING:return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(P.a,{intervalMs:2e3,messages:v.b,useFirstItemStart:!0,render:function(e){return Object(F.jsx)(S.a,{children:e},e)}}),Object(F.jsx)(I.a,{url:D,isPending:!0})]});case u.f.FULFILLED:return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)("div",{children:"Proposal submitted!"}),Object(F.jsx)(I.a,{url:D})]});default:return null}}()}),_&&Object(F.jsx)("button",{className:"button--help-centered",onClick:T,children:"Why is processing disabled?"})]}),Object(F.jsx)(W,{title:"Why is processing disabled?"})]})}var M=n(245),A=c.c.Completed,D=c.c.OffchainVotingGracePeriod,R=c.c.OffchainVotingSubmitResult,y=c.c.OffchainVoting,C=c.c.Process,G=c.c.Submit,L=d.a.FULFILLED,_=[u.b.offchainVotingVotingPeriod,u.b.offchainVotingGracePeriod];function T(e){var t,n=e.adapterName,c=e.proposal,d=e.renderAction,u=Object(b.d)(_),f=Object(o.a)(u.daoConfigurations,2),O=f[0],h=f[1],x=Object(i.e)(Object(s.useMemo)((function(){return{proposal:c}}),[c])),g=x.daoProposalVoteResult,m=x.daoProposalVote,w=x.proposalFlowStatusError,v=x.status,N=x.stopPollingForStatus,P=Object(i.c)(c.snapshotProposal),I=P.offchainVotingResults,S=P.offchainVotingResultsStatus,E=1e3*Number((null===m||void 0===m?void 0:m.gracePeriodStartingTime)||0),V=E+1e3*Number(h||0),T=1e3*Number((null===m||void 0===m?void 0:m.startingTime)||0),W=T+1e3*Number(O||0),U=null===(t=I[0])||void 0===t?void 0:t[1],J=(null===U||void 0===U?void 0:U.Yes.units)||0,Y=(null===U||void 0===U?void 0:U.No.units)||0,q=d&&d(Object(r.a)({},j.c.OffchainVotingContract,{adapterName:n,daoProposalVote:m,daoProposalVoteResult:g,gracePeriodEndMs:V,gracePeriodStartMs:E,proposal:c,status:v}));return Object(s.useEffect)((function(){v===R&&S===L&&J<=Y&&N()}),[Y,S,v,N,J]),Object(F.jsxs)(F.Fragment,{children:[(v===y||v===R||v===D||v===C||v===A)&&Object(F.jsx)(a.c,{countdownGracePeriodEndMs:V,countdownGracePeriodStartMs:E,countdownVotingEndMs:W,countdownVotingStartMs:T,renderStatus:function(e){if(e.hasGracePeriodEnded&&v===D)return Object(F.jsxs)("span",{children:["Grace period ended ",Object(F.jsx)("br",{})," ",Object(F.jsxs)("span",{style:{textTransform:"lowercase"},children:["Awaiting contract status",Object(F.jsx)(l.a,{})]})]})},votingResult:U}),Object(F.jsx)("div",{className:"proposaldetails__button-container",children:q||(v===G?Object(F.jsx)(M.a,{proposal:c}):v===y?Object(F.jsx)(a.b,{adapterName:n,proposal:c}):v===R?S!==L||J<=Y?null:Object(F.jsx)(a.a,{adapterName:n,proposal:c}):v===C||v===D?Object(F.jsx)(k,{disabled:v===D,proposal:c}):void 0)}),Object(F.jsx)(p.a,{error:w,renderText:"Something went wrong while getting the proposal's status"})]})}}}]);
//# sourceMappingURL=8.c39a77c7.chunk.js.map